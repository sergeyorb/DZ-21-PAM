[sergey@localhost ~]$ sudo useradd day
[sudo] password for sergey:
^Csudo: 1 incorrect password attempt
[sergey@localhost ~]$ clear
[sergey@localhost ~]$ sudo -i
[sudo] password for sergey:
[root@localhost ~]# sudo useradd day
[root@localhost ~]# sudo useradd night
[root@localhost ~]# sudo useradd friday
[root@localhost ~]# sudo passwd --stdin day
Changing password for user day.

^C
[root@localhost ~]# echo "Otus2019"|sudo passwd --stdin day
Changing password for user day.
passwd: all authentication tokens updated successfully.
[root@localhost ~]# echo "Otus2019" | sudo passwd --stdin night
Changing password for user night.
passwd: all authentication tokens updated successfully.
[root@localhost ~]# echo "Otus2019" | sudo passwd --stdin friday
Changing password for user friday.
passwd: all authentication tokens updated successfully.
[root@localhost ~]# cat /etc/security/time.conf
# this is an example configuration file for the pam_time module. Its syntax
# was initially based heavily on that of the shadow package (shadow-960129).
#
# the syntax of the lines is as follows:
#
#       services;ttys;users;times
#
# white space is ignored and lines maybe extended with '\\n' (escaped
# newlines). As should be clear from reading these comments,
# text following a '#' is ignored to the end of the line.
#
# the combination of individual users/terminals etc is a logic list
# namely individual tokens that are optionally prefixed with '!' (logical
# not) and separated with '&' (logical and) and '|' (logical or).
#
# services
#       is a logic list of PAM service names that the rule applies to.
#
# ttys
#       is a logic list of terminal names that this rule applies to.
#
# users
#       is a logic list of users or a netgroup of users to whom this
#       rule applies.
#
# NB. For these items the simple wildcard '*' may be used only once.
#
# times
#       the format here is a logic list of day/time-range
#       entries the days are specified by a sequence of two character
#       entries, MoTuSa for example is Monday Tuesday and Saturday. Note
#       that repeated days are unset MoMo = no day, and MoWk = all weekdays
#       bar Monday. The two character combinations accepted are
#
#               Mo Tu We Th Fr Sa Su Wk Wd Al
#
#       the last two being week-end days and all 7 days of the week
#       respectively. As a final example, AlFr means all days except Friday.
#
#       each day/time-range can be prefixed with a '!' to indicate "anything
#       but"
#
#       The time-range part is two 24-hour times HHMM separated by a hyphen
#       indicating the start and finish time (if the finish time is smaller
#       than the start time it is deemed to apply on the following day).
#
# for a rule to be active, ALL of service+ttys+users must be satisfied
# by the applying process.
#

#
# Here is a simple example: running blank on tty* (any ttyXXX device),
# the users 'you' and 'me' are denied service all of the time
#

#blank;tty* & !ttyp*;you|me;!Al0000-2400

# Another silly example, user 'root' is denied xsh access
# from pseudo terminals at the weekend and on mondays.

#xsh;ttyp*;root;!WdMo0000-2400

#
# End of example file.
#
*;*;day;Al0800-2000
*;*;night;!Al0800-2000
*;*;friday;Fr
[root@localhost ~]#

[root@localhost ~]# cat /etc/pam.d/sshd
#%PAM-1.0
auth       required     pam_sepermit.so
auth       substack     password-auth
auth       include      postlogin
# Used with polkit to reauthorize users in remote sessions
-auth      optional     pam_reauthorize.so prepare
account    required     pam_nologin.so
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      password-auth
session    include      postlogin
# Used with polkit to reauthorize users in remote sessions
-session   optional     pam_reauthorize.so prepare
[root@localhost ~]# 
[root@localhost ~]# cat /etc/pam.d/sshd
#%PAM-1.0
auth       required     pam_sepermit.so
auth       substack     password-auth
auth       include      postlogin
# Used with polkit to reauthorize users in remote sessions
-auth      optional     pam_reauthorize.so prepare
account    required     pam_nologin.so
account    required     pam_exec.so /usr/local/bin/test_login.sh
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      password-auth
session    include      postlogin
# Used with polkit to reauthorize users in remote sessions
-session   optional     pam_reauthorize.so prepare
[root@localhost ~]# cat /usr/local/bin/test_login.sh
#!/bin/bash

if [ $PAM_USER = "friday" ]; then
  if [ $(date +%a) = "Fri" ]; then
      exit 0
    else
      exit 1
  fi
fi

hour=$(date +%H)

is_day_hours=$(($(test $hour -ge 8; echo $?)+$(test $hour -lt 20; echo $?)))

if [ $PAM_USER = "day" ]; then
  if [ $is_day_hours -eq 0 ]; then
      exit 0
    else
      exit 1
  fi
fi

if [ $PAM_USER = "night" ]; then
  if [ $is_day_hours -eq 1 ]; then
      exit 0
    else
      exit 1
  fi
fi
[root@localhost ~]#
[root@localhost ~]# yum -y install epel-release
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.yandex.ru
 * extras: mirror.corbina.net
 * updates: mirror.corbina.net
Resolving Dependencies
--> Running transaction check
---> Package epel-release.noarch 0:7-11 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

==============================================================================================================================================================================================================
 Package                                               Arch                                            Version                                          Repository                                       Size
==============================================================================================================================================================================================================
Installing:
 epel-release                                          noarch                                          7-11                                             extras                                           15 k

Transaction Summary
==============================================================================================================================================================================================================
Install  1 Package

Total download size: 15 k
Installed size: 24 k
Downloading packages:
epel-release-7-11.noarch.rpm                                                                                                                                                           |  15 kB  00:00:00
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : epel-release-7-11.noarch                                                                                                                                                                   1/1
  Verifying  : epel-release-7-11.noarch                                                                                                                                                                   1/1

Installed:
  epel-release.noarch 0:7-11

Complete!
[root@localhost ~]# cat /etc/yum.conf
[main]
cachedir=/var/cache/yum/$basearch/$releasever
keepcache=0
debuglevel=2
logfile=/var/log/yum.log
exactarch=1
obsoletes=1
gpgcheck=1
plugins=1
installonly_limit=5
bugtracker_url=http://bugs.centos.org/set_project.php?project_id=23&ref=http://bugs.centos.org/bug_report_page.php?category=yum
distroverpkg=centos-release


#  This is the default, if you make this bigger yum won't see if the metadata
# is newer on the remote and so you'll "gain" the bandwidth of not having to
# download the new metadata and "pay" for it by yum not having correct
# information.
#  It is esp. important, to have correct metadata, for distributions like
# Fedora which don't keep old packages around. If you don't like this checking
# interupting your command line usage, it's much better to have something
# manually check the metadata once an hour (yum-updatesd will do this).
# metadata_expire=90m

# PUT YOUR REPOS HERE OR IN separate files named file.repo
# in /etc/yum.repos.d
[root@localhost ~]#
[root@localhost ~]# yum install $pkg
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
epel/x86_64/metalink                                                                                                                                                                   |  25 kB  00:00:00
 * base: mirror.yandex.ru
 * epel: mirror.yandex.ru
 * extras: mirror.corbina.net
 * updates: mirror.corbina.net
epel                                                                                                                                                                                   | 4.7 kB  00:00:00
(1/3): epel/x86_64/group_gz                                                                                                                                                            |  96 kB  00:00:00
(2/3): epel/x86_64/updateinfo                                                                                                                                                          | 1.1 MB  00:00:00
(3/3): epel/x86_64/primary_db                                                                                                                                                          | 7.0 MB  00:00:01
Resolving Dependencies
--> Running transaction check
---> Package pam_script.x86_64 0:1.1.8-1.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

==============================================================================================================================================================================================================
 Package                                             Arch                                            Version                                              Repository                                     Size
==============================================================================================================================================================================================================
Installing:
 pam_script                                          x86_64                                          1.1.8-1.el7                                          epel                                           28 k

Transaction Summary
==============================================================================================================================================================================================================
Install  1 Package

Total download size: 28 k
Installed size: 62 k
Is this ok [y/d/N]: y
Downloading packages:
warning: /var/cache/yum/x86_64/7/epel/packages/pam_script-1.1.8-1.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 352c64e5: NOKEY                                    ]  0.0 B/s |    0 B  --:--:-- ETA
Public key for pam_script-1.1.8-1.el7.x86_64.rpm is not installed
pam_script-1.1.8-1.el7.x86_64.rpm                                                                                                                                                      |  28 kB  00:00:05
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Importing GPG key 0x352C64E5:
 Userid     : "Fedora EPEL (7) <epel@fedoraproject.org>"
 Fingerprint: 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5
 Package    : epel-release-7-11.noarch (@extras)
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Is this ok [y/N]: y
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : pam_script-1.1.8-1.el7.x86_64                                                                                                                                                              1/1
  Verifying  : pam_script-1.1.8-1.el7.x86_64                                                                                                                                                              1/1

Installed:
  pam_script.x86_64 0:1.1.8-1.el7

Complete!
[root@localhost ~]#
[root@localhost ~]# cat /etc/pam.d/sshd
#%PAM-1.0
auth       required     pam_sepermit.so
auth       substack     password-auth
auth       include      postlogin
# Used with polkit to reauthorize users in remote sessions
-auth      optional     pam_reauthorize.so prepare
account    required     pam_nologin.so
account    required     pam_script.so /usr/local/bin/test_login.sh
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      password-auth
session    include      postlogin
# Used with polkit to reauthorize users in remote sessions
-session   optional     pam_reauthorize.so prepare
[root@localhost ~]#
[root@localhost ~]# yum install nmap-ncat
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.yandex.ru
 * epel: mirrors.sgu.ru
 * extras: mirror.corbina.net
 * updates: mirror.corbina.net
Resolving Dependencies
--> Running transaction check
---> Package nmap-ncat.x86_64 2:6.40-19.el7 will be installed
--> Processing Dependency: libpcap.so.1()(64bit) for package: 2:nmap-ncat-6.40-19.el7.x86_64
--> Running transaction check
---> Package libpcap.x86_64 14:1.5.3-13.el7_9 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

==============================================================================================================================================================================================================
 Package                                          Arch                                          Version                                                  Repository                                      Size
==============================================================================================================================================================================================================
Installing:
 nmap-ncat                                        x86_64                                        2:6.40-19.el7                                            base                                           206 k
Installing for dependencies:
 libpcap                                          x86_64                                        14:1.5.3-13.el7_9                                        updates                                        139 k

Transaction Summary
==============================================================================================================================================================================================================
Install  1 Package (+1 Dependent package)

Total download size: 345 k
Installed size: 740 k
Is this ok [y/d/N]: y
Downloading packages:
(1/2): nmap-ncat-6.40-19.el7.x86_64.rpm                                                                                                                                                | 206 kB  00:00:05
(2/2): libpcap-1.5.3-13.el7_9.x86_64.rpm                                                                                                                                               | 139 kB  00:00:05
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                                                          59 kB/s | 345 kB  00:00:05
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : 14:libpcap-1.5.3-13.el7_9.x86_64                                                                                                                                                           1/2
  Installing : 2:nmap-ncat-6.40-19.el7.x86_64                                                                                                                                                             2/2
  Verifying  : 2:nmap-ncat-6.40-19.el7.x86_64                                                                                                                                                             1/2
  Verifying  : 14:libpcap-1.5.3-13.el7_9.x86_64                                                                                                                                                           2/2

Installed:
  nmap-ncat.x86_64 2:6.40-19.el7

Dependency Installed:
  libpcap.x86_64 14:1.5.3-13.el7_9

Complete!
[root@localhost ~]#
[root@localhost ~]# cat /etc/pam.d/sshd
#%PAM-1.0
auth       required     pam_sepermit.so
auth       substack     password-auth
auth       include      postlogin
auth       required     pam_cap.so
# Used with polkit to reauthorize users in remote sessions
-auth      optional     pam_reauthorize.so prepare
account    required     pam_nologin.so
account    required     pam_script.so /usr/local/bin/test_login.sh
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      password-auth
session    include      postlogin
# Used with polkit to reauthorize users in remote sessions
-session   optional     pam_reauthorize.so prepare
[root@localhost ~]#
[root@localhost ~]# cat /etc/security/capability.conf
cap_net_bind_service   day
[root@localhost ~]# setcap cap_net_bind_service=ei /usr/bin/ncat

echo "Make Linux great again!" > \/dev/tcp/127.0.0.7/80